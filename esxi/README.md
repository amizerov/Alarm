# Vmware Esxi - Управление виртуалками по ssh

## Подключение по ssh

> Для того чтобы включить доступ к серверу Vmware Esxi нужно воспользоваться по идее статьей в базе знаний vmware 

https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.security.doc/GUID-DFA67697-232E-4F7D-860F-96C0819570A8.html
https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.security.doc/GUID-DFA67697-232E-4F7D-860F-96C0819570A8.html
https://kb.vmware.com/s/article/8375637

Но все гораздо проще, находясь в вебинтерфейсе нужно сделать клик как я показал стрелками на рисунке

![2023-01-19_02-36-50](https://user-images.githubusercontent.com/121182772/213319053-4644fc62-8caf-4a21-9a1e-e0f3a8f6781a.png)


> Смс пользователь отправляет с мобильного телефона, а принимает их типичный для таких сценариев [Huawei e3372h](https://market.yandex.ru/product--4g-lte-modem-huawei-e3372h-320/667862013?cpa=1) прошитый специальным образом
 
 
 ## Архитектура и принцип действия

> Смс отправляется с устройства типа умных часов нажатием кнопки сос на определенный номер, номер симкарты, которая установлена в модеме. Модем с помощью openvpn туннеля связан с сервером, через этот туннель, с помощью api модема смс менеджер через промежутки времени (30 сек по умолчанию, устанавливается в sms-diver.sh) производит опрос модема на предмет новых смс. При поступлении смс она проверяется на соответствие условиям - номеру/содержанию (все эти условия задаются как переменные в начале скрипта) и если она удовлетворяет условиям - на хост с ESXI по ssh отправляется команда о перезагрузке\остановке виртуальной машины.  

> На рисунке изображены связи участников схемы между собой



![Architecture](test/sms-manager.png)

## Требования

Нам понадобится следующее:

1. Модем **Huawei e3372h-320** или **Huawei e3372h** но не в коем случае не **e3372s** 
2. Симкарта неважно с каким тарифом, главное чтобы смски доходили. У многих операторов есть тарифы для смарт-устройств
3. Сервер c Ubuntu Linux 20.04 и статическим IP, именно на нем будет выполняться sms-manager
4. Часы с кнопкой SOS, иницирующие отправку смс на модем
5. Данные пользователя на хост с Vmware ESXI, имеющего права на перезагрузку виртуальных машин



## Установка

Установка sms-manager состоит из нескольких вещей:

- [Прошивка модема](firmware/README.md)
- [Настройка сервера](server/README.md)
- [Тестирование](test/README.md)
