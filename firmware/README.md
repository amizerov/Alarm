
![e3372h](https://user-images.githubusercontent.com/121182772/209736163-8a0d7af8-45e2-428b-8b57-15fd83209f4b.jpeg)



# Порядок действий по подготовке мопеда e3372 #


Для корректной работы модема с сервером необходимо разлочить модем чтобы он мог работать с симкартой любого оператора (а не только того, в чьем салоне вы купили модем) и прошить его специальной прошивкой, расширяющей его функционал, в частности мы получим возможность установить клиент openvpn

В этой папке есть все, что необходимо чтобы прошить модем, утилиты и прошивальщики максимально автоматизированы, тем не менее часть действий необходимо будет выполнить руками.


### 0. Подключение модема

Подключаем модем к компьютеру, и ждем пока windows автоматически установит все необходимые драйвера. В windows 10 это происходит полностью автоматически - ручные действия не требуются.

### 1. Получение flash кода для прошивки ###

* `DС-Unlocker` запустить с правами администратора => выбрать тип Huawei modems =>  нажать поиск => получить `emei`
* Если нет, то emei вставить в `utils/huaweicalc` => скопировать полученный flash код, запускаем `set_hilink_switch_01`
* Сохраняем в блокнотике `flash` код, вероятно он понадобится далее

### 2. Прошивка системной части модема ###

* Прошиваем стабильную, рабочую прошивку `E3372h-153_Update_22.200.15.00.00_M_AT_05`
* Для этого запускаем соответствующий файл и следуем инструкциям. Обычно процесс происходит в режиме далее-далее-готово, но в процессе прошивальщик может запросить код из п.1

### 3. Прошивка вебинтерфейса ###

* Прошивкаем последнюю версию вебинтерфейса, сейчас это `Update_WEBUI_17.100.18.03.143_HILINK_Mod1.21_V7R2_9x25_V7R11_CPIO`

* Для этого запускаем соответствующий файл и следуем инструкциям. Обычно процесс происходит в режиме далее-далее-готово

### 4. Меняем emei ###

* Запускаем утилиту  `change_imei` => 2 => enter => 3 => ждем пока ребутнется мопед
* 
* Проверяем в вебинтерфейсе что emei начинается на 35

![emei](https://user-images.githubusercontent.com/121182772/209737058-828632e2-54de-4855-81c1-80b90a41f727.png)



### 5. Заливаем конфигурацию  туннеля и скриптов для поднятия туннеля с сервером ###


* Конфигурация openvpn, она находится в архиве `path.tgz` и называется `myvpntunnel.ovpn` Ее необходимо изменить указав ip нашего сервера и закрыть архив так чтобы он сохранил изменения.

![2022-12-28_02-57-31](https://user-images.githubusercontent.com/121182772/209737935-5e5a1876-e2b6-40b3-8895-9fc77bd86f63.png)


* Запускаем `go_and_flash_erase` для заливки конфигурации. Этот скрипт зальет все файлы, необходимые для работы openvpn



### 6. Проверка корректности работы туннеля

После указанных выше операций модем необходимо выдернуть и воткнуть снова, после чего с помощью `putty` зайти на модем и выполнить команду

**ping 192.168.101.2**

Хост должен быть доступен, это значит что туннель до сервера поднят и эта часть установки закончена.

Если это не так, нужно проверить файл `/online/ovpn/openvpn.log` на наличие ошибок
